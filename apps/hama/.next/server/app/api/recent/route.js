"use strict";(()=>{var e={};e.id=8703,e.ids=[8703],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1470:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>_});var s={};t.r(s),t.d(s,{GET:()=>c});var o=t(3036),n=t(5736),a=t(5262),i=t(942),u=t(851);let p=process.env.NEXT_PUBLIC_SUPABASE_URL,d=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;async function c(e){let r=e.nextUrl.searchParams.get("user_id"),t=Math.min(Number(e.nextUrl.searchParams.get("limit"))||20,50);if(!r)return i.NextResponse.json({error:"user_id required"},{status:400});let s=p&&d?(0,u.eI)(p,d):null;if(!s)return i.NextResponse.json({error:"DB not configured"},{status:500});let{data:o,error:n}=await s.from("recent_views").select("store_id, viewed_at").eq("user_id",r).order("viewed_at",{ascending:!1}).limit(t);if(n)return console.error("recent GET error:",n),i.NextResponse.json({error:n.message},{status:500});let a=(o??[]).map(e=>e.store_id);if(0===a.length)return i.NextResponse.json({store_ids:[],stores:[]});let{data:c,error:l}=await s.from("stores").select("*").in("id",a);if(l)return console.error("recent stores fetch error:",l),i.NextResponse.json({store_ids:a,stores:[]});let m=new Map(a.map((e,r)=>[e,r])),_=(c??[]).sort((e,r)=>(m.get(e.id)??999)-(m.get(r.id)??999));return i.NextResponse.json({store_ids:a,stores:_})}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/recent/route",pathname:"/api/recent",filename:"route",bundlePath:"app/api/recent/route"},resolvedPagePath:"C:\\Users\\ubtj1\\hama-frontend\\apps\\hama\\app\\api\\recent\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:x}=l,f="/api/recent/route";function g(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:_})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4522,1746,851],()=>t(1470));module.exports=s})();