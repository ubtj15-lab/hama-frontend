"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/places/nearby/route";
exports.ids = ["app/api/places/nearby/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fplaces%2Fnearby%2Froute&page=%2Fapi%2Fplaces%2Fnearby%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fplaces%2Fnearby%2Froute.ts&appDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fplaces%2Fnearby%2Froute&page=%2Fapi%2Fplaces%2Fnearby%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fplaces%2Fnearby%2Froute.ts&appDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_ubtj1_hama_frontend_apps_hama_app_api_places_nearby_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/places/nearby/route.ts */ \"(rsc)/./app/api/places/nearby/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/places/nearby/route\",\n        pathname: \"/api/places/nearby\",\n        filename: \"route\",\n        bundlePath: \"app/api/places/nearby/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\ubtj1\\\\hama-frontend\\\\apps\\\\hama\\\\app\\\\api\\\\places\\\\nearby\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_ubtj1_hama_frontend_apps_hama_app_api_places_nearby_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/places/nearby/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGcGxhY2VzJTJGbmVhcmJ5JTJGcm91dGUmcGFnZT0lMkZhcGklMkZwbGFjZXMlMkZuZWFyYnklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZwbGFjZXMlMkZuZWFyYnklMkZyb3V0ZS50cyZhcHBEaXI9QyUzQSU1Q1VzZXJzJTVDdWJ0ajElNUNoYW1hLWZyb250ZW5kJTVDYXBwcyU1Q2hhbWElNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3VidGoxJTVDaGFtYS1mcm9udGVuZCU1Q2FwcHMlNUNoYW1hJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMrQjtBQUM1RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2hhbWEvPzZlY2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcdWJ0ajFcXFxcaGFtYS1mcm9udGVuZFxcXFxhcHBzXFxcXGhhbWFcXFxcYXBwXFxcXGFwaVxcXFxwbGFjZXNcXFxcbmVhcmJ5XFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9wbGFjZXMvbmVhcmJ5L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcGxhY2VzL25lYXJieVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcGxhY2VzL25lYXJieS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXHVidGoxXFxcXGhhbWEtZnJvbnRlbmRcXFxcYXBwc1xcXFxoYW1hXFxcXGFwcFxcXFxhcGlcXFxccGxhY2VzXFxcXG5lYXJieVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcGxhY2VzL25lYXJieS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fplaces%2Fnearby%2Froute&page=%2Fapi%2Fplaces%2Fnearby%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fplaces%2Fnearby%2Froute.ts&appDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/places/nearby/route.ts":
/*!****************************************!*\
  !*** ./app/api/places/nearby/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/index.mjs\");\n\n\nfunction categoryToKakaoGroup(tab) {\n    if (tab === \"cafe\") return \"CE7\";\n    if (tab === \"restaurant\") return \"FD6\";\n    return null; // 미용/액티비티는 일단 제외(원하면 확장)\n}\nfunction safeNum(v) {\n    const n = Number(v);\n    return Number.isFinite(n) ? n : null;\n}\nfunction pickAreaFromAddress(addr) {\n    if (!addr) return null;\n    // \"경기 화성시 ...\" 같은 주소면 시/구 정도만 area로\n    const parts = addr.split(\" \").filter(Boolean);\n    if (parts.length >= 2) return `${parts[0]} ${parts[1]}`;\n    return parts[0] ?? null;\n}\nfunction makeSupabaseAdmin() {\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url || !serviceKey) throw new Error(\"Missing SUPABASE env\");\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(url, serviceKey, {\n        auth: {\n            persistSession: false\n        }\n    });\n}\nasync function fetchDbNearbyPool(params) {\n    const supabase = makeSupabaseAdmin();\n    const { lat, lng, tab, radiusKm, limit } = params;\n    const latDelta = radiusKm / 111;\n    const lngDelta = radiusKm / (111 * Math.cos(lat * Math.PI / 180));\n    const minLat = lat - latDelta;\n    const maxLat = lat + latDelta;\n    const minLng = lng - lngDelta;\n    const maxLng = lng + lngDelta;\n    let q = supabase.from(\"stores\").select(`\r\n      id,\r\n      name,\r\n      category,\r\n      area,\r\n      address,\r\n      lat,\r\n      lng,\r\n      phone,\r\n      image_url,\r\n      kakao_place_url,\r\n      naver_place_id,\r\n      mood,\r\n      tags,\r\n      curated_score,\r\n      updated_at,\r\n      source,\r\n      place_key\r\n    `).gte(\"lat\", minLat).lte(\"lat\", maxLat).gte(\"lng\", minLng).lte(\"lng\", maxLng).limit(limit);\n    if (tab !== \"all\") q = q.eq(\"category\", tab);\n    // 운영자 점수/최신 우선은 유지(후보풀은 넉넉히 받고, 클라에서 랜덤픽)\n    q = q.order(\"curated_score\", {\n        ascending: false,\n        nullsFirst: false\n    }).order(\"updated_at\", {\n        ascending: false,\n        nullsFirst: false\n    });\n    const { data, error } = await q;\n    if (error) {\n        console.error(\"[dbNearbyPool]\", error);\n        return [];\n    }\n    return data ?? [];\n}\nasync function fetchKakaoNearby(params) {\n    const apiKey = process.env.KAKAO_REST_API_KEY;\n    if (!apiKey) throw new Error(\"Missing KAKAO_REST_API_KEY\");\n    const group = categoryToKakaoGroup(params.tab);\n    if (!group) return [];\n    const radiusMeters = Math.min(Math.max(Math.floor(params.radiusKm * 1000), 100), 20000); // Kakao max 20km\n    const url = new URL(\"https://dapi.kakao.com/v2/local/search/category.json\");\n    url.searchParams.set(\"category_group_code\", group);\n    url.searchParams.set(\"x\", String(params.lng)); // Kakao: x=lng\n    url.searchParams.set(\"y\", String(params.lat)); // Kakao: y=lat\n    url.searchParams.set(\"radius\", String(radiusMeters));\n    url.searchParams.set(\"size\", String(Math.min(params.size, 15))); // Kakao size max 15\n    url.searchParams.set(\"sort\", \"distance\");\n    const res = await fetch(url.toString(), {\n        headers: {\n            Authorization: `KakaoAK ${apiKey}`\n        },\n        cache: \"no-store\"\n    });\n    if (!res.ok) {\n        const t = await res.text().catch(()=>\"\");\n        console.error(\"[kakaoNearby] fail\", res.status, t);\n        return [];\n    }\n    const json = await res.json();\n    const docs = Array.isArray(json?.documents) ? json.documents : [];\n    return docs;\n}\nfunction kakaoDocToUpsert(doc, tab) {\n    const name = doc?.place_name ?? null;\n    const address = doc?.road_address_name ?? doc?.address_name ?? null;\n    const phone = doc?.phone ?? null;\n    const lat = safeNum(doc?.y); // Kakao y=lat\n    const lng = safeNum(doc?.x); // Kakao x=lng\n    const kakaoUrl = doc?.place_url ?? null;\n    const placeKey = doc?.id ? String(doc.id) : null;\n    return {\n        name,\n        category: tab === \"all\" ? null : tab,\n        area: pickAreaFromAddress(address),\n        address,\n        lat,\n        lng,\n        phone,\n        image_url: null,\n        kakao_place_url: kakaoUrl,\n        naver_place_id: null,\n        mood: [],\n        tags: [],\n        with_kids: null,\n        for_work: null,\n        reservation_required: null,\n        price_level: null,\n        curated_score: 0,\n        updated_at: new Date().toISOString(),\n        source: \"kakao\",\n        place_key: placeKey\n    };\n}\nfunction rowToHomeCard(row) {\n    // HomeSwipeDeck가 쓰는 필드만 맞춰주면 됨\n    return {\n        id: row.id,\n        name: row.name ?? \"\",\n        category: row.category ?? null,\n        categoryLabel: row.category === \"restaurant\" ? \"식당\" : row.category === \"cafe\" ? \"카페\" : row.category === \"salon\" ? \"미용\" : row.category === \"activity\" ? \"액티비티\" : \"장소\",\n        area: row.area ?? null,\n        address: row.address ?? null,\n        lat: row.lat ?? null,\n        lng: row.lng ?? null,\n        phone: row.phone ?? null,\n        image_url: row.image_url ?? null,\n        imageUrl: row.image_url ?? null,\n        kakao_place_url: row.kakao_place_url ?? null,\n        naver_place_id: row.naver_place_id ?? null,\n        mood: Array.isArray(row.mood) ? row.mood : [],\n        moodText: Array.isArray(row.mood) ? row.mood.slice(0, 2).join(\" \\xb7 \") : \"\",\n        tags: Array.isArray(row.tags) ? row.tags : [],\n        curated_score: typeof row.curated_score === \"number\" ? row.curated_score : 0,\n        updated_at: row.updated_at ?? null,\n        source: row.source ?? null,\n        place_key: row.place_key ?? null\n    };\n}\nasync function GET(req) {\n    try {\n        const { searchParams } = new URL(req.url);\n        const lat = Number(searchParams.get(\"lat\"));\n        const lng = Number(searchParams.get(\"lng\"));\n        const tab = searchParams.get(\"tab\") ?? \"all\";\n        const radiusKm = Number(searchParams.get(\"radiusKm\") ?? \"4\");\n        const limit = Number(searchParams.get(\"limit\") ?? \"40\"); // ✅ 후보 풀 사이즈\n        if (!Number.isFinite(lat) || !Number.isFinite(lng)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                ok: false,\n                error: \"invalid lat/lng\"\n            }, {\n                status: 400\n            });\n        }\n        const safeTab = [\n            \"all\",\n            \"restaurant\",\n            \"cafe\",\n            \"salon\",\n            \"activity\"\n        ];\n        if (!safeTab.includes(tab)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                ok: false,\n                error: \"invalid tab\"\n            }, {\n                status: 400\n            });\n        }\n        // 1) DB 근처 후보 풀\n        const dbRows = await fetchDbNearbyPool({\n            lat,\n            lng,\n            tab,\n            radiusKm,\n            limit\n        });\n        // 2) 부족하면 카카오로 보충(식당/카페만)\n        const need = Math.max(0, limit - dbRows.length);\n        let merged = dbRows;\n        if (need > 0) {\n            // Kakao는 한 번에 최대 15라 여러 번 호출해야 할 수 있음\n            const supabase = makeSupabaseAdmin();\n            let fetched = [];\n            let remain = need;\n            while(remain > 0){\n                const batchSize = Math.min(remain, 15);\n                const docs = await fetchKakaoNearby({\n                    lat,\n                    lng,\n                    tab,\n                    radiusKm,\n                    size: batchSize\n                });\n                if (!docs.length) break;\n                fetched = fetched.concat(docs);\n                remain -= docs.length;\n                // Kakao 응답이 적게 오면 더 돌려봐도 의미 없음\n                if (docs.length < batchSize) break;\n            }\n            if (fetched.length > 0) {\n                const upserts = fetched.map((d)=>kakaoDocToUpsert(d, tab)).filter((x)=>x.place_key && x.name && x.lat != null && x.lng != null);\n                if (upserts.length > 0) {\n                    // ✅ place_key unique 기준 upsert\n                    const { error: upsertErr } = await supabase.from(\"stores\").upsert(upserts, {\n                        onConflict: \"place_key\"\n                    });\n                    if (upsertErr) console.error(\"[kakao upsert]\", upsertErr);\n                }\n                // upsert 후 다시 DB에서 최신 풀 재조회(합쳐진 결과를 안정적으로 받기)\n                merged = await fetchDbNearbyPool({\n                    lat,\n                    lng,\n                    tab,\n                    radiusKm,\n                    limit\n                });\n            }\n        }\n        const cards = merged.map(rowToHomeCard);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            cards\n        });\n    } catch (e) {\n        console.error(\"[/api/places/nearby]\", e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: false,\n            error: e?.message ?? \"unknown\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dXRlLnRzPzg4NWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcclxuXHJcbnR5cGUgSG9tZVRhYktleSA9IFwiYWxsXCIgfCBcInJlc3RhdXJhbnRcIiB8IFwiY2FmZVwiIHwgXCJzYWxvblwiIHwgXCJhY3Rpdml0eVwiO1xyXG5cclxudHlwZSBTdG9yZVVwc2VydCA9IHtcclxuICBpZD86IHN0cmluZzsgLy8gc3VwYWJhc2XqsIAg6riw67O47YKkIOyekOuPmeydtOuptCDsl4bslrTrj4Qg65CoXHJcbiAgbmFtZTogc3RyaW5nIHwgbnVsbDtcclxuICBjYXRlZ29yeTogc3RyaW5nIHwgbnVsbDtcclxuICBhcmVhOiBzdHJpbmcgfCBudWxsO1xyXG4gIGFkZHJlc3M6IHN0cmluZyB8IG51bGw7XHJcbiAgbGF0OiBudW1iZXIgfCBudWxsO1xyXG4gIGxuZzogbnVtYmVyIHwgbnVsbDtcclxuICBwaG9uZTogc3RyaW5nIHwgbnVsbDtcclxuICBpbWFnZV91cmw6IHN0cmluZyB8IG51bGw7XHJcbiAga2FrYW9fcGxhY2VfdXJsOiBzdHJpbmcgfCBudWxsO1xyXG4gIG5hdmVyX3BsYWNlX2lkOiBzdHJpbmcgfCBudWxsO1xyXG4gIG1vb2Q6IHN0cmluZ1tdIHwgbnVsbDtcclxuICB0YWdzOiBzdHJpbmdbXSB8IG51bGw7XHJcbiAgd2l0aF9raWRzOiBib29sZWFuIHwgbnVsbDtcclxuICBmb3Jfd29yazogYm9vbGVhbiB8IG51bGw7XHJcbiAgcmVzZXJ2YXRpb25fcmVxdWlyZWQ6IGJvb2xlYW4gfCBudWxsO1xyXG4gIHByaWNlX2xldmVsOiBzdHJpbmcgfCBudWxsO1xyXG4gIGN1cmF0ZWRfc2NvcmU6IG51bWJlciB8IG51bGw7XHJcbiAgdXBkYXRlZF9hdDogc3RyaW5nIHwgbnVsbDtcclxuXHJcbiAgc291cmNlOiBzdHJpbmcgfCBudWxsO1xyXG4gIHBsYWNlX2tleTogc3RyaW5nIHwgbnVsbDtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNhdGVnb3J5VG9LYWthb0dyb3VwKHRhYjogSG9tZVRhYktleSk6IHN0cmluZyB8IG51bGwge1xyXG4gIGlmICh0YWIgPT09IFwiY2FmZVwiKSByZXR1cm4gXCJDRTdcIjtcclxuICBpZiAodGFiID09PSBcInJlc3RhdXJhbnRcIikgcmV0dXJuIFwiRkQ2XCI7XHJcbiAgcmV0dXJuIG51bGw7IC8vIOuvuOyaqS/slaHti7DruYTti7DripQg7J2864uoIOygnOyZuCjsm5DtlZjrqbQg7ZmV7J6lKVxyXG59XHJcblxyXG5mdW5jdGlvbiBzYWZlTnVtKHY6IGFueSk6IG51bWJlciB8IG51bGwge1xyXG4gIGNvbnN0IG4gPSBOdW1iZXIodik7XHJcbiAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZShuKSA/IG4gOiBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwaWNrQXJlYUZyb21BZGRyZXNzKGFkZHI6IHN0cmluZyB8IG51bGwpOiBzdHJpbmcgfCBudWxsIHtcclxuICBpZiAoIWFkZHIpIHJldHVybiBudWxsO1xyXG4gIC8vIFwi6rK96riwIO2ZlOyEseyLnCAuLi5cIiDqsJnsnYAg7KO87IaM66m0IOyLnC/qtawg7KCV64+E66eMIGFyZWHroZxcclxuICBjb25zdCBwYXJ0cyA9IGFkZHIuc3BsaXQoXCIgXCIpLmZpbHRlcihCb29sZWFuKTtcclxuICBpZiAocGFydHMubGVuZ3RoID49IDIpIHJldHVybiBgJHtwYXJ0c1swXX0gJHtwYXJ0c1sxXX1gO1xyXG4gIHJldHVybiBwYXJ0c1swXSA/PyBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYWtlU3VwYWJhc2VBZG1pbigpIHtcclxuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbiAgY29uc3Qgc2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XHJcbiAgaWYgKCF1cmwgfHwgIXNlcnZpY2VLZXkpIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgU1VQQUJBU0UgZW52XCIpO1xyXG4gIHJldHVybiBjcmVhdGVDbGllbnQodXJsLCBzZXJ2aWNlS2V5LCB7IGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0gfSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGZldGNoRGJOZWFyYnlQb29sKHBhcmFtczoge1xyXG4gIGxhdDogbnVtYmVyO1xyXG4gIGxuZzogbnVtYmVyO1xyXG4gIHRhYjogSG9tZVRhYktleTtcclxuICByYWRpdXNLbTogbnVtYmVyO1xyXG4gIGxpbWl0OiBudW1iZXI7XHJcbn0pIHtcclxuICBjb25zdCBzdXBhYmFzZSA9IG1ha2VTdXBhYmFzZUFkbWluKCk7XHJcbiAgY29uc3QgeyBsYXQsIGxuZywgdGFiLCByYWRpdXNLbSwgbGltaXQgfSA9IHBhcmFtcztcclxuXHJcbiAgY29uc3QgbGF0RGVsdGEgPSByYWRpdXNLbSAvIDExMTtcclxuICBjb25zdCBsbmdEZWx0YSA9IHJhZGl1c0ttIC8gKDExMSAqIE1hdGguY29zKChsYXQgKiBNYXRoLlBJKSAvIDE4MCkpO1xyXG5cclxuICBjb25zdCBtaW5MYXQgPSBsYXQgLSBsYXREZWx0YTtcclxuICBjb25zdCBtYXhMYXQgPSBsYXQgKyBsYXREZWx0YTtcclxuICBjb25zdCBtaW5MbmcgPSBsbmcgLSBsbmdEZWx0YTtcclxuICBjb25zdCBtYXhMbmcgPSBsbmcgKyBsbmdEZWx0YTtcclxuXHJcbiAgbGV0IHEgPSBzdXBhYmFzZVxyXG4gICAgLmZyb20oXCJzdG9yZXNcIilcclxuICAgIC5zZWxlY3QoXHJcbiAgICAgIGBcclxuICAgICAgaWQsXHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIGNhdGVnb3J5LFxyXG4gICAgICBhcmVhLFxyXG4gICAgICBhZGRyZXNzLFxyXG4gICAgICBsYXQsXHJcbiAgICAgIGxuZyxcclxuICAgICAgcGhvbmUsXHJcbiAgICAgIGltYWdlX3VybCxcclxuICAgICAga2FrYW9fcGxhY2VfdXJsLFxyXG4gICAgICBuYXZlcl9wbGFjZV9pZCxcclxuICAgICAgbW9vZCxcclxuICAgICAgdGFncyxcclxuICAgICAgY3VyYXRlZF9zY29yZSxcclxuICAgICAgdXBkYXRlZF9hdCxcclxuICAgICAgc291cmNlLFxyXG4gICAgICBwbGFjZV9rZXlcclxuICAgIGBcclxuICAgIClcclxuICAgIC5ndGUoXCJsYXRcIiwgbWluTGF0KVxyXG4gICAgLmx0ZShcImxhdFwiLCBtYXhMYXQpXHJcbiAgICAuZ3RlKFwibG5nXCIsIG1pbkxuZylcclxuICAgIC5sdGUoXCJsbmdcIiwgbWF4TG5nKVxyXG4gICAgLmxpbWl0KGxpbWl0KTtcclxuXHJcbiAgaWYgKHRhYiAhPT0gXCJhbGxcIikgcSA9IHEuZXEoXCJjYXRlZ29yeVwiLCB0YWIpO1xyXG5cclxuICAvLyDsmrTsmIHsnpAg7KCQ7IiYL+y1nOyLoCDsmrDshKDsnYAg7Jyg7KeAKO2bhOuztO2SgOydgCDrhInrhIntnogg67Cb6rOgLCDtgbTrnbzsl5DshJwg656c642k7ZS9KVxyXG4gIHEgPSBxXHJcbiAgICAub3JkZXIoXCJjdXJhdGVkX3Njb3JlXCIsIHsgYXNjZW5kaW5nOiBmYWxzZSwgbnVsbHNGaXJzdDogZmFsc2UgfSlcclxuICAgIC5vcmRlcihcInVwZGF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlLCBudWxsc0ZpcnN0OiBmYWxzZSB9KTtcclxuXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcTtcclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJOZWFyYnlQb29sXVwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG4gIHJldHVybiAoZGF0YSA/PyBbXSkgYXMgYW55W107XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGZldGNoS2FrYW9OZWFyYnkocGFyYW1zOiB7XHJcbiAgbGF0OiBudW1iZXI7XHJcbiAgbG5nOiBudW1iZXI7XHJcbiAgdGFiOiBIb21lVGFiS2V5O1xyXG4gIHJhZGl1c0ttOiBudW1iZXI7XHJcbiAgc2l6ZTogbnVtYmVyO1xyXG59KSB7XHJcbiAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuS0FLQU9fUkVTVF9BUElfS0VZO1xyXG4gIGlmICghYXBpS2V5KSB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIEtBS0FPX1JFU1RfQVBJX0tFWVwiKTtcclxuXHJcbiAgY29uc3QgZ3JvdXAgPSBjYXRlZ29yeVRvS2FrYW9Hcm91cChwYXJhbXMudGFiKTtcclxuICBpZiAoIWdyb3VwKSByZXR1cm4gW107XHJcblxyXG4gIGNvbnN0IHJhZGl1c01ldGVycyA9IE1hdGgubWluKE1hdGgubWF4KE1hdGguZmxvb3IocGFyYW1zLnJhZGl1c0ttICogMTAwMCksIDEwMCksIDIwMDAwKTsgLy8gS2FrYW8gbWF4IDIwa21cclxuICBjb25zdCB1cmwgPSBuZXcgVVJMKFwiaHR0cHM6Ly9kYXBpLmtha2FvLmNvbS92Mi9sb2NhbC9zZWFyY2gvY2F0ZWdvcnkuanNvblwiKTtcclxuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNhdGVnb3J5X2dyb3VwX2NvZGVcIiwgZ3JvdXApO1xyXG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwieFwiLCBTdHJpbmcocGFyYW1zLmxuZykpOyAvLyBLYWthbzogeD1sbmdcclxuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInlcIiwgU3RyaW5nKHBhcmFtcy5sYXQpKTsgLy8gS2FrYW86IHk9bGF0XHJcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJyYWRpdXNcIiwgU3RyaW5nKHJhZGl1c01ldGVycykpO1xyXG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwic2l6ZVwiLCBTdHJpbmcoTWF0aC5taW4ocGFyYW1zLnNpemUsIDE1KSkpOyAvLyBLYWthbyBzaXplIG1heCAxNVxyXG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwic29ydFwiLCBcImRpc3RhbmNlXCIpO1xyXG5cclxuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwudG9TdHJpbmcoKSwge1xyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBBdXRob3JpemF0aW9uOiBgS2FrYW9BSyAke2FwaUtleX1gLFxyXG4gICAgfSxcclxuICAgIGNhY2hlOiBcIm5vLXN0b3JlXCIsXHJcbiAgfSk7XHJcblxyXG4gIGlmICghcmVzLm9rKSB7XHJcbiAgICBjb25zdCB0ID0gYXdhaXQgcmVzLnRleHQoKS5jYXRjaCgoKSA9PiBcIlwiKTtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJba2FrYW9OZWFyYnldIGZhaWxcIiwgcmVzLnN0YXR1cywgdCk7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG5cclxuICBjb25zdCBqc29uID0gYXdhaXQgcmVzLmpzb24oKTtcclxuICBjb25zdCBkb2NzID0gQXJyYXkuaXNBcnJheShqc29uPy5kb2N1bWVudHMpID8ganNvbi5kb2N1bWVudHMgOiBbXTtcclxuICByZXR1cm4gZG9jcyBhcyBhbnlbXTtcclxufVxyXG5cclxuZnVuY3Rpb24ga2FrYW9Eb2NUb1Vwc2VydChkb2M6IGFueSwgdGFiOiBIb21lVGFiS2V5KTogU3RvcmVVcHNlcnQge1xyXG4gIGNvbnN0IG5hbWUgPSAoZG9jPy5wbGFjZV9uYW1lID8/IG51bGwpIGFzIHN0cmluZyB8IG51bGw7XHJcbiAgY29uc3QgYWRkcmVzcyA9IChkb2M/LnJvYWRfYWRkcmVzc19uYW1lID8/IGRvYz8uYWRkcmVzc19uYW1lID8/IG51bGwpIGFzIHN0cmluZyB8IG51bGw7XHJcbiAgY29uc3QgcGhvbmUgPSAoZG9jPy5waG9uZSA/PyBudWxsKSBhcyBzdHJpbmcgfCBudWxsO1xyXG5cclxuICBjb25zdCBsYXQgPSBzYWZlTnVtKGRvYz8ueSk7IC8vIEtha2FvIHk9bGF0XHJcbiAgY29uc3QgbG5nID0gc2FmZU51bShkb2M/LngpOyAvLyBLYWthbyB4PWxuZ1xyXG5cclxuICBjb25zdCBrYWthb1VybCA9IChkb2M/LnBsYWNlX3VybCA/PyBudWxsKSBhcyBzdHJpbmcgfCBudWxsO1xyXG4gIGNvbnN0IHBsYWNlS2V5ID0gZG9jPy5pZCA/IFN0cmluZyhkb2MuaWQpIDogbnVsbDtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG5hbWUsXHJcbiAgICBjYXRlZ29yeTogdGFiID09PSBcImFsbFwiID8gbnVsbCA6IHRhYixcclxuICAgIGFyZWE6IHBpY2tBcmVhRnJvbUFkZHJlc3MoYWRkcmVzcyksXHJcbiAgICBhZGRyZXNzLFxyXG4gICAgbGF0LFxyXG4gICAgbG5nLFxyXG4gICAgcGhvbmUsXHJcbiAgICBpbWFnZV91cmw6IG51bGwsXHJcbiAgICBrYWthb19wbGFjZV91cmw6IGtha2FvVXJsLFxyXG4gICAgbmF2ZXJfcGxhY2VfaWQ6IG51bGwsXHJcbiAgICBtb29kOiBbXSxcclxuICAgIHRhZ3M6IFtdLFxyXG4gICAgd2l0aF9raWRzOiBudWxsLFxyXG4gICAgZm9yX3dvcms6IG51bGwsXHJcbiAgICByZXNlcnZhdGlvbl9yZXF1aXJlZDogbnVsbCxcclxuICAgIHByaWNlX2xldmVsOiBudWxsLFxyXG4gICAgY3VyYXRlZF9zY29yZTogMCxcclxuICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuXHJcbiAgICBzb3VyY2U6IFwia2FrYW9cIixcclxuICAgIHBsYWNlX2tleTogcGxhY2VLZXksXHJcbiAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gcm93VG9Ib21lQ2FyZChyb3c6IGFueSkge1xyXG4gIC8vIEhvbWVTd2lwZURlY2vqsIAg7JOw64qUIO2VhOuTnOunjCDrp57strDso7zrqbQg65CoXHJcbiAgcmV0dXJuIHtcclxuICAgIGlkOiByb3cuaWQsXHJcbiAgICBuYW1lOiByb3cubmFtZSA/PyBcIlwiLFxyXG4gICAgY2F0ZWdvcnk6IHJvdy5jYXRlZ29yeSA/PyBudWxsLFxyXG4gICAgY2F0ZWdvcnlMYWJlbDpcclxuICAgICAgcm93LmNhdGVnb3J5ID09PSBcInJlc3RhdXJhbnRcIlxyXG4gICAgICAgID8gXCLsi53ri7lcIlxyXG4gICAgICAgIDogcm93LmNhdGVnb3J5ID09PSBcImNhZmVcIlxyXG4gICAgICAgID8gXCLsubTtjphcIlxyXG4gICAgICAgIDogcm93LmNhdGVnb3J5ID09PSBcInNhbG9uXCJcclxuICAgICAgICA/IFwi66+47JqpXCJcclxuICAgICAgICA6IHJvdy5jYXRlZ29yeSA9PT0gXCJhY3Rpdml0eVwiXHJcbiAgICAgICAgPyBcIuyVoe2LsOu5hO2LsFwiXHJcbiAgICAgICAgOiBcIuyepeyGjFwiLFxyXG4gICAgYXJlYTogcm93LmFyZWEgPz8gbnVsbCxcclxuICAgIGFkZHJlc3M6IHJvdy5hZGRyZXNzID8/IG51bGwsXHJcbiAgICBsYXQ6IHJvdy5sYXQgPz8gbnVsbCxcclxuICAgIGxuZzogcm93LmxuZyA/PyBudWxsLFxyXG4gICAgcGhvbmU6IHJvdy5waG9uZSA/PyBudWxsLFxyXG4gICAgaW1hZ2VfdXJsOiByb3cuaW1hZ2VfdXJsID8/IG51bGwsXHJcbiAgICBpbWFnZVVybDogcm93LmltYWdlX3VybCA/PyBudWxsLFxyXG4gICAga2FrYW9fcGxhY2VfdXJsOiByb3cua2FrYW9fcGxhY2VfdXJsID8/IG51bGwsXHJcbiAgICBuYXZlcl9wbGFjZV9pZDogcm93Lm5hdmVyX3BsYWNlX2lkID8/IG51bGwsXHJcbiAgICBtb29kOiBBcnJheS5pc0FycmF5KHJvdy5tb29kKSA/IHJvdy5tb29kIDogW10sXHJcbiAgICBtb29kVGV4dDogQXJyYXkuaXNBcnJheShyb3cubW9vZCkgPyByb3cubW9vZC5zbGljZSgwLCAyKS5qb2luKFwiIMK3IFwiKSA6IFwiXCIsXHJcbiAgICB0YWdzOiBBcnJheS5pc0FycmF5KHJvdy50YWdzKSA/IHJvdy50YWdzIDogW10sXHJcbiAgICBjdXJhdGVkX3Njb3JlOiB0eXBlb2Ygcm93LmN1cmF0ZWRfc2NvcmUgPT09IFwibnVtYmVyXCIgPyByb3cuY3VyYXRlZF9zY29yZSA6IDAsXHJcbiAgICB1cGRhdGVkX2F0OiByb3cudXBkYXRlZF9hdCA/PyBudWxsLFxyXG4gICAgc291cmNlOiByb3cuc291cmNlID8/IG51bGwsXHJcbiAgICBwbGFjZV9rZXk6IHJvdy5wbGFjZV9rZXkgPz8gbnVsbCxcclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogUmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXEudXJsKTtcclxuXHJcbiAgICBjb25zdCBsYXQgPSBOdW1iZXIoc2VhcmNoUGFyYW1zLmdldChcImxhdFwiKSk7XHJcbiAgICBjb25zdCBsbmcgPSBOdW1iZXIoc2VhcmNoUGFyYW1zLmdldChcImxuZ1wiKSk7XHJcbiAgICBjb25zdCB0YWIgPSAoc2VhcmNoUGFyYW1zLmdldChcInRhYlwiKSA/PyBcImFsbFwiKSBhcyBIb21lVGFiS2V5O1xyXG5cclxuICAgIGNvbnN0IHJhZGl1c0ttID0gTnVtYmVyKHNlYXJjaFBhcmFtcy5nZXQoXCJyYWRpdXNLbVwiKSA/PyBcIjRcIik7XHJcbiAgICBjb25zdCBsaW1pdCA9IE51bWJlcihzZWFyY2hQYXJhbXMuZ2V0KFwibGltaXRcIikgPz8gXCI0MFwiKTsgLy8g4pyFIO2bhOuztCDtkoAg7IKs7J207KaIXHJcblxyXG4gICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUobGF0KSB8fCAhTnVtYmVyLmlzRmluaXRlKGxuZykpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogXCJpbnZhbGlkIGxhdC9sbmdcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHNhZmVUYWI6IEhvbWVUYWJLZXlbXSA9IFtcImFsbFwiLCBcInJlc3RhdXJhbnRcIiwgXCJjYWZlXCIsIFwic2Fsb25cIiwgXCJhY3Rpdml0eVwiXTtcclxuICAgIGlmICghc2FmZVRhYi5pbmNsdWRlcyh0YWIpKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiBmYWxzZSwgZXJyb3I6IFwiaW52YWxpZCB0YWJcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDEpIERCIOq3vOyymCDtm4Trs7Qg7ZKAXHJcbiAgICBjb25zdCBkYlJvd3MgPSBhd2FpdCBmZXRjaERiTmVhcmJ5UG9vbCh7XHJcbiAgICAgIGxhdCxcclxuICAgICAgbG5nLFxyXG4gICAgICB0YWIsXHJcbiAgICAgIHJhZGl1c0ttLFxyXG4gICAgICBsaW1pdCxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIDIpIOu2gOyhse2VmOuptCDsubTsubTsmKTroZwg67O07LapKOyLneuLuS/subTtjpjrp4wpXHJcbiAgICBjb25zdCBuZWVkID0gTWF0aC5tYXgoMCwgbGltaXQgLSBkYlJvd3MubGVuZ3RoKTtcclxuICAgIGxldCBtZXJnZWQgPSBkYlJvd3M7XHJcblxyXG4gICAgaWYgKG5lZWQgPiAwKSB7XHJcbiAgICAgIC8vIEtha2Fv64qUIO2VnCDrsojsl5Ag7LWc64yAIDE16528IOyXrOufrCDrsogg7Zi47Lac7ZW07JW8IO2VoCDsiJgg7J6I7J2MXHJcbiAgICAgIGNvbnN0IHN1cGFiYXNlID0gbWFrZVN1cGFiYXNlQWRtaW4oKTtcclxuXHJcbiAgICAgIGxldCBmZXRjaGVkOiBhbnlbXSA9IFtdO1xyXG4gICAgICBsZXQgcmVtYWluID0gbmVlZDtcclxuXHJcbiAgICAgIHdoaWxlIChyZW1haW4gPiAwKSB7XHJcbiAgICAgICAgY29uc3QgYmF0Y2hTaXplID0gTWF0aC5taW4ocmVtYWluLCAxNSk7XHJcbiAgICAgICAgY29uc3QgZG9jcyA9IGF3YWl0IGZldGNoS2FrYW9OZWFyYnkoeyBsYXQsIGxuZywgdGFiLCByYWRpdXNLbSwgc2l6ZTogYmF0Y2hTaXplIH0pO1xyXG4gICAgICAgIGlmICghZG9jcy5sZW5ndGgpIGJyZWFrO1xyXG4gICAgICAgIGZldGNoZWQgPSBmZXRjaGVkLmNvbmNhdChkb2NzKTtcclxuICAgICAgICByZW1haW4gLT0gZG9jcy5sZW5ndGg7XHJcblxyXG4gICAgICAgIC8vIEtha2FvIOydkeuLteydtCDsoIHqsowg7Jik66m0IOuNlCDrj4zroKTrtJDrj4Qg7J2Y66+4IOyXhuydjFxyXG4gICAgICAgIGlmIChkb2NzLmxlbmd0aCA8IGJhdGNoU2l6ZSkgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChmZXRjaGVkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCB1cHNlcnRzID0gZmV0Y2hlZFxyXG4gICAgICAgICAgLm1hcCgoZCkgPT4ga2FrYW9Eb2NUb1Vwc2VydChkLCB0YWIpKVxyXG4gICAgICAgICAgLmZpbHRlcigoeCkgPT4geC5wbGFjZV9rZXkgJiYgeC5uYW1lICYmIHgubGF0ICE9IG51bGwgJiYgeC5sbmcgIT0gbnVsbCk7XHJcblxyXG4gICAgICAgIGlmICh1cHNlcnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIC8vIOKchSBwbGFjZV9rZXkgdW5pcXVlIOq4sOykgCB1cHNlcnRcclxuICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IHVwc2VydEVyciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgLmZyb20oXCJzdG9yZXNcIilcclxuICAgICAgICAgICAgLnVwc2VydCh1cHNlcnRzLCB7IG9uQ29uZmxpY3Q6IFwicGxhY2Vfa2V5XCIgfSk7XHJcblxyXG4gICAgICAgICAgaWYgKHVwc2VydEVycikgY29uc29sZS5lcnJvcihcIltrYWthbyB1cHNlcnRdXCIsIHVwc2VydEVycik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyB1cHNlcnQg7ZuEIOuLpOyLnCBEQuyXkOyEnCDstZzsi6Ag7ZKAIOyerOyhsO2ajCjtlanss5Dsp4Qg6rKw6rO866W8IOyViOygleyggeycvOuhnCDrsJvquLApXHJcbiAgICAgICAgbWVyZ2VkID0gYXdhaXQgZmV0Y2hEYk5lYXJieVBvb2woeyBsYXQsIGxuZywgdGFiLCByYWRpdXNLbSwgbGltaXQgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjYXJkcyA9IG1lcmdlZC5tYXAocm93VG9Ib21lQ2FyZCk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogdHJ1ZSwgY2FyZHMgfSk7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiWy9hcGkvcGxhY2VzL25lYXJieV1cIiwgZSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogZmFsc2UsIGVycm9yOiBlPy5tZXNzYWdlID8/IFwidW5rbm93blwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVDbGllbnQiLCJjYXRlZ29yeVRvS2FrYW9Hcm91cCIsInRhYiIsInNhZmVOdW0iLCJ2IiwibiIsIk51bWJlciIsImlzRmluaXRlIiwicGlja0FyZWFGcm9tQWRkcmVzcyIsImFkZHIiLCJwYXJ0cyIsInNwbGl0IiwiZmlsdGVyIiwiQm9vbGVhbiIsImxlbmd0aCIsIm1ha2VTdXBhYmFzZUFkbWluIiwidXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJhdXRoIiwicGVyc2lzdFNlc3Npb24iLCJmZXRjaERiTmVhcmJ5UG9vbCIsInBhcmFtcyIsInN1cGFiYXNlIiwibGF0IiwibG5nIiwicmFkaXVzS20iLCJsaW1pdCIsImxhdERlbHRhIiwibG5nRGVsdGEiLCJNYXRoIiwiY29zIiwiUEkiLCJtaW5MYXQiLCJtYXhMYXQiLCJtaW5MbmciLCJtYXhMbmciLCJxIiwiZnJvbSIsInNlbGVjdCIsImd0ZSIsImx0ZSIsImVxIiwib3JkZXIiLCJhc2NlbmRpbmciLCJudWxsc0ZpcnN0IiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsImZldGNoS2FrYW9OZWFyYnkiLCJhcGlLZXkiLCJLQUtBT19SRVNUX0FQSV9LRVkiLCJncm91cCIsInJhZGl1c01ldGVycyIsIm1pbiIsIm1heCIsImZsb29yIiwiVVJMIiwic2VhcmNoUGFyYW1zIiwic2V0IiwiU3RyaW5nIiwic2l6ZSIsInJlcyIsImZldGNoIiwidG9TdHJpbmciLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsImNhY2hlIiwib2siLCJ0IiwidGV4dCIsImNhdGNoIiwic3RhdHVzIiwianNvbiIsImRvY3MiLCJBcnJheSIsImlzQXJyYXkiLCJkb2N1bWVudHMiLCJrYWthb0RvY1RvVXBzZXJ0IiwiZG9jIiwibmFtZSIsInBsYWNlX25hbWUiLCJhZGRyZXNzIiwicm9hZF9hZGRyZXNzX25hbWUiLCJhZGRyZXNzX25hbWUiLCJwaG9uZSIsInkiLCJ4Iiwia2FrYW9VcmwiLCJwbGFjZV91cmwiLCJwbGFjZUtleSIsImlkIiwiY2F0ZWdvcnkiLCJhcmVhIiwiaW1hZ2VfdXJsIiwia2FrYW9fcGxhY2VfdXJsIiwibmF2ZXJfcGxhY2VfaWQiLCJtb29kIiwidGFncyIsIndpdGhfa2lkcyIsImZvcl93b3JrIiwicmVzZXJ2YXRpb25fcmVxdWlyZWQiLCJwcmljZV9sZXZlbCIsImN1cmF0ZWRfc2NvcmUiLCJ1cGRhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic291cmNlIiwicGxhY2Vfa2V5Iiwicm93VG9Ib21lQ2FyZCIsInJvdyIsImNhdGVnb3J5TGFiZWwiLCJpbWFnZVVybCIsIm1vb2RUZXh0Iiwic2xpY2UiLCJqb2luIiwiR0VUIiwicmVxIiwiZ2V0Iiwic2FmZVRhYiIsImluY2x1ZGVzIiwiZGJSb3dzIiwibmVlZCIsIm1lcmdlZCIsImZldGNoZWQiLCJyZW1haW4iLCJiYXRjaFNpemUiLCJjb25jYXQiLCJ1cHNlcnRzIiwibWFwIiwiZCIsInVwc2VydEVyciIsInVwc2VydCIsIm9uQ29uZmxpY3QiLCJjYXJkcyIsImUiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/places/nearby/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fplaces%2Fnearby%2Froute&page=%2Fapi%2Fplaces%2Fnearby%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fplaces%2Fnearby%2Froute.ts&appDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cubtj1%5Chama-frontend%5Capps%5Chama&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();