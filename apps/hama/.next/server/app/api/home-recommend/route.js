"use strict";(()=>{var e={};e.id=1500,e.ids=[1500],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6840:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var a={};t.r(a),t.d(a,{GET:()=>h,dynamic:()=>m,revalidate:()=>c});var o=t(3036),n=t(5736),s=t(5262),l=t(942),i=t(851);let m="force-dynamic",c=0,u=[{category:"restaurant",n:4},{category:"cafe",n:4},{category:"salon",n:2},{category:"activity",n:2}];function d(e,r=200){return l.NextResponse.json(e,{status:r,headers:{"Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate",Pragma:"no-cache",Expires:"0"}})}async function h(e){try{let r=new URL(e.url),t=r.searchParams.get("tab")||"all",a=function(e){let r=(e||"all").toLowerCase().trim();return"beauty"===r?"salon":r}(t),o=function(e,r){let t=Number(e);return Number.isFinite(t)&&t>0?Math.floor(t):r}(r.searchParams.get("count"),"all"===a?12:5),n=process.env.NEXT_PUBLIC_SUPABASE_URL,s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(console.log("[home-recommend] tab:",a,"count:",o),console.log("[home-recommend] hasUrl:",!!n),console.log("[home-recommend] hasAnonKey:",!!s),!n||!s)return d({items:[],error:"missing_env"},500);let l=(0,i.eI)(n,s);if("all"!==a){let{data:e,error:r}=await l.from("stores").select("*").eq("category",a).not("name","is",null).neq("name","").order("id",{ascending:!1});if(r)return console.error("[home-recommend] supabase error:",r),d({items:[],error:"supabase_select_failed",detail:r.message},500);let t=Array.isArray(e)?[...e]:[];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return d({items:t.slice(0,o)},200)}let m=function(e){let r=u.reduce((e,r)=>e+r.n,0);if(e===r)return u;let t=e/r;return u.map(e=>({category:e.category,n:Math.max(1,Math.round(e.n*t))}))}(o),c=e=>Math.min(Math.max(6*e,60),400),h=m.map(e=>l.from("stores").select("*").eq("category",e.category).not("name","is",null).neq("name","").limit(c(e.n))),p=await Promise.all(h);for(let e of p)if(e.error)return console.error("[home-recommend] supabase error:",e.error),d({items:[],error:"supabase_select_failed",detail:e.error.message},500);let f=[...p.flatMap((e,r)=>{let t=Array.isArray(e.data)?[...e.data]:[];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t.slice(0,m[r]?.n??0)})];for(let e=f.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[f[e],f[r]]=[f[r],f[e]]}return d({items:f.slice(0,o)},200)}catch(e){return console.error("[home-recommend] unexpected error:",e),d({items:[],error:"failed_to_load",detail:e?.message??String(e)},500)}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/home-recommend/route",pathname:"/api/home-recommend",filename:"route",bundlePath:"app/api/home-recommend/route"},resolvedPagePath:"C:\\Users\\ubtj1\\hama-frontend\\apps\\hama\\app\\api\\home-recommend\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:y}=p,v="/api/home-recommend/route";function x(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[4522,1746,851],()=>t(6840));module.exports=a})();