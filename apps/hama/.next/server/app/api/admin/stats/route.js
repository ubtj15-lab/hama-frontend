"use strict";(()=>{var e={};e.id=6553,e.ids=[6553],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},102:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var o={};a.r(o),a.d(o,{GET:()=>d});var c=a(3036),n=a(5736),r=a(5262),s=a(942),i=a(851);let _=process.env.NEXT_PUBLIC_SUPABASE_URL,l=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,p=["home_card_open","place_open_naver","place_open_kakao","place_detail_action","search_recommend_card_click"];async function d(){let e=_&&l?(0,i.eI)(_,l):null;if(!e)return s.NextResponse.json({error:"DB not configured"},{status:500});let t=function(){let e=new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"});return new Date(`${e}T00:00:00+09:00`).toISOString()}();try{let a={},o={};for(let c of p){let{count:n,error:r}=await e.from("events").select("*",{count:"exact",head:!0}).eq("type",c);r&&console.error("[admin/stats] events",c,r),a[c]=n??0;let{count:s,error:i}=await e.from("events").select("*",{count:"exact",head:!0}).eq("type",c).gte("created_at",t);i&&console.error("[admin/stats] events today",c,i),o[c]=s??0}let[{count:c},{count:n}]=await Promise.all([e.from("saved").select("*",{count:"exact",head:!0}),e.from("saved").select("*",{count:"exact",head:!0}).gte("created_at",t)]),[{count:r},{count:i}]=await Promise.all([e.from("recent_views").select("*",{count:"exact",head:!0}),e.from("recent_views").select("*",{count:"exact",head:!0}).gte("viewed_at",t)]),_=(a.place_open_naver??0)+(a.place_open_kakao??0)+(a.place_detail_action??0),l=(o.place_open_naver??0)+(o.place_open_kakao??0)+(o.place_detail_action??0);return s.NextResponse.json({today:{card_views:o.home_card_open??0,saved_count:n??0,recent_views_count:i??0,naver_clicks:o.place_open_naver??0,kakao_clicks:o.place_open_kakao??0,detail_actions:o.place_detail_action??0,search_clicks:o.search_recommend_card_click??0,total_clicks:l},total:{card_views:a.home_card_open??0,saved_count:c??0,recent_views_count:r??0,naver_clicks:a.place_open_naver??0,kakao_clicks:a.place_open_kakao??0,detail_actions:a.place_detail_action??0,search_clicks:a.search_recommend_card_click??0,total_clicks:_}})}catch(e){return console.error("[admin/stats]",e),s.NextResponse.json({error:"Failed to fetch stats"},{status:500})}}let u=new c.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/stats/route",pathname:"/api/admin/stats",filename:"route",bundlePath:"app/api/admin/stats/route"},resolvedPagePath:"C:\\Users\\ubtj1\\hama-frontend\\apps\\hama\\app\\api\\admin\\stats\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:k}=u,h="/api/admin/stats/route";function f(){return(0,r.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[4522,1746,851],()=>a(102));module.exports=o})();