(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{863:function(e,t,s){Promise.resolve().then(s.bind(s,7558))},7558:function(e,t,s){"use strict";s.d(t,{default:function(){return d}});var a=s(7573),r=s(7653),n=s(1695);function l(){let e=(0,n.useRouter)(),t=async()=>{await fetch("/api/admin/logout",{method:"POST"}),e.replace("/admin/login")};return(0,a.jsxs)("div",{className:"flex justify-end items-center gap-3 mb-4",children:[(0,a.jsx)("a",{href:"/admin",className:"text-sm text-blue-600 hover:underline",children:"통계 대시보드"}),(0,a.jsx)("a",{href:"/admin/stores",className:"text-sm text-blue-600 hover:underline",children:"매장 연결"}),(0,a.jsx)("button",{onClick:t,className:"rounded-md border px-3 py-1.5 text-sm hover:bg-gray-50",title:"관리자 로그아웃",children:"로그아웃"})]})}let c=e=>{try{let t=new Date(e),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return"".concat(s,". ").concat(a,". ").concat(r,". ").concat(n,":").concat(l)}catch(t){return e}};function d(){let e=(0,n.useSearchParams)(),[t,s]=(0,r.useState)([]),[d,i]=(0,r.useState)(!1),[o,x]=(0,r.useState)(""),h=(0,r.useMemo)(()=>{let t=t=>{var s;return(null!==(s=null==e?void 0:e.get(t))&&void 0!==s?s:"").trim()},s={store:t("store"),address:t("addr"),phone:t("phone"),name:t("name"),people:t("people"),date:t("date"),time:t("time"),note:t("note"),x:t("x"),y:t("y")};return Object.values(s).some(e=>e)?s:null},[e]),m=async()=>{i(!0);try{let e=await fetch("/api/reservations",{method:"GET"}),t=await e.json();e.ok&&(null==t?void 0:t.ok)?s(t.items||[]):(console.error(t),alert("목록을 불러오지 못했습니다."))}catch(e){console.error(e),alert("목록 조회 중 오류가 발생했습니다.")}finally{i(!1)}};(0,r.useEffect)(()=>{m()},[]);let p=(0,r.useMemo)(()=>{if(!o.trim())return t;let e=o.trim().toLowerCase();return t.filter(t=>{var s;return[t.id,t.store,t.address,t.phone,t.name,null!==(s=t.note)&&void 0!==s?s:"",t.date,t.time].join(" ").toLowerCase().includes(e)})},[t,o]),u=async e=>{if(confirm("정말 삭제할까요?"))try{let t=await fetch("/api/reservations/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok||!(null==a?void 0:a.ok)){alert("삭제 실패");return}s(t=>t.filter(t=>t.id!==e))}catch(e){console.error(e),alert("삭제 중 오류가 발생했습니다.")}},y=async()=>{if(!h)return;let e=["가게명: ".concat(h.store||"-"),"주소: ".concat(h.address||"-"),"전화: ".concat(h.phone||"-"),"좌표: ".concat(h.y||"-",", ").concat(h.x||"-")].join("\n");await navigator.clipboard.writeText(e),alert("복사 완료!")},j=async()=>{if(h)try{let e={store:h.store||"-",address:h.address||"-",phone:h.phone||"-",name:h.name||"하마자동등록",people:Number(h.people||1),date:h.date||new Date().toISOString().slice(0,10),time:h.time||"12:00",note:h.note||"",lat:h.y?Number(h.y):null,lng:h.x?Number(h.x):null},t=await fetch("/api/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok||!(null==s?void 0:s.ok)){alert("예약 생성 실패");return}alert("예약 정보가 DB에 등록되었습니다!"),m()}catch(e){console.error(e),alert("예약 생성 중 오류가 발생했습니다.")}};return(0,a.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-6",children:[(0,a.jsx)(l,{}),(0,a.jsx)("h1",{className:"mb-4 text-2xl font-bold",children:"예약 내역"}),(0,a.jsxs)("div",{className:"mb-6 rounded-lg border p-4",children:[(0,a.jsx)("div",{className:"mb-2 flex items-center gap-2",children:(0,a.jsx)("span",{className:"text-sky-600",children:"\uD83D\uDC99 지도에서 전달된 예약 정보"})}),(0,a.jsxs)("div",{className:"text-sm leading-6 text-gray-700",children:[(0,a.jsxs)("div",{children:["가게명: ",(null==h?void 0:h.store)||"-"]}),(0,a.jsxs)("div",{children:["주소: ",(null==h?void 0:h.address)||"-"]}),(0,a.jsxs)("div",{children:["전화: ",(null==h?void 0:h.phone)||"-"]}),(0,a.jsxs)("div",{children:["좌표: ",(null==h?void 0:h.y)||"-",", ",(null==h?void 0:h.x)||"-"]})]}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("button",{onClick:y,className:"rounded-md bg-gray-700 px-3 py-2 text-sm text-white hover:opacity-90",children:"한 번에 복사"}),(0,a.jsx)("button",{onClick:j,className:"rounded-md bg-green-600 px-3 py-2 text-sm text-white hover:opacity-90",children:"⚡ 자동 등록(실제)"})]})]}),(0,a.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,a.jsx)("input",{value:o,onChange:e=>x(e.target.value),placeholder:"검색: 가게명/주소/전화/이름/비고/날짜/시간…",className:"w-full rounded-md border px-3 py-2 text-sm"}),(0,a.jsx)("button",{onClick:m,className:"whitespace-nowrap rounded-md border px-3 py-2 text-sm hover:bg-gray-50",children:"\uD83D\uDD04 조회"})]}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border",children:(0,a.jsxs)("table",{className:"min-w-full text-left text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50 text-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"ID"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"생성일"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"가게명"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"주소"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"전화"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"예약자"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"인원"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"예약일"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"시간"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"비고"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"삭제"})]})}),(0,a.jsxs)("tbody",{children:[d&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:11,className:"px-3 py-6 text-center text-gray-500",children:"불러오는 중…"})}),!d&&0===p.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:11,className:"px-3 py-6 text-center text-gray-500",children:"아직 데이터가 없습니다. 상단에서 “자동 등록(실제)”을 눌러 생성해보세요."})}),!d&&p.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2",children:e.id}),(0,a.jsx)("td",{className:"px-3 py-2",children:c(e.createdAt)}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.store}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.address}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.phone}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.people}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.date}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.time}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.note||""}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("button",{onClick:()=>u(e.id),className:"rounded-md bg-rose-500 px-2 py-1 text-xs text-white hover:opacity-90",children:"삭제"})})]},e.id))]})]})})]})}},1695:function(e,t,s){"use strict";var a=s(1219);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[293,528,744],function(){return e(e.s=863)}),_N_E=e.O()}]);