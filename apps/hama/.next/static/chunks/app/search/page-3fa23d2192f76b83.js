(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{1482:function(e,n,t){Promise.resolve().then(t.bind(t,8760))},3123:function(e,n,t){"use strict";t.d(n,{X:function(){return r}});var l=t(7653),o=t(5708),i=t(5099);function r(){let[e,n]=(0,l.useState)([]),[t,r]=(0,l.useState)(!1),a=(0,i.n)(),s=(0,l.useCallback)(async()=>{if(!(!a||a.startsWith("server"))){r(!0);try{var e;let t=await fetch("/api/recent?user_id=".concat(encodeURIComponent(a),"&limit=20")),l=await t.json(),i=null!==(e=l.stores)&&void 0!==e?e:[];n(i.map(e=>(0,o.O)(e)))}catch(e){n([])}finally{r(!1)}}},[a]),u=(0,l.useCallback)(async e=>{if(!(!a||a.startsWith("server")))try{await fetch("/api/recent/record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a,store_id:e})}),await s()}catch(e){}},[a,s]);return(0,l.useEffect)(()=>{s()},[s]),{recentCards:e,loading:t,recordView:u,refetch:s}}},5142:function(e,n,t){"use strict";t.d(n,{F:function(){return r}});var l=t(7653),o=t(5708),i=t(5099);function r(){let[e,n]=(0,l.useState)(new Set),[t,r]=(0,l.useState)([]),[a,s]=(0,l.useState)(!1),u=(0,i.n)(),d=(0,l.useCallback)(async()=>{if(!(!u||u.startsWith("server"))){s(!0);try{var e,t;let l=await fetch("/api/saved?user_id=".concat(encodeURIComponent(u))),i=await l.json();n(new Set(null!==(e=i.saved_ids)&&void 0!==e?e:[])),r((null!==(t=i.stores)&&void 0!==t?t:[]).map(e=>(0,o.O)(e)))}catch(e){n(new Set),r([])}finally{s(!1)}}},[u]),c=(0,l.useCallback)(async t=>{if(!u||u.startsWith("server"))return!1;let l=e.has(t);n(e=>{let n=new Set(e);return l?n.delete(t):n.add(t),n});try{let e=await fetch("/api/saved",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:u,store_id:t})}),o=await e.json();if(!o.ok)return n(e=>{let n=new Set(e);return l?n.add(t):n.delete(t),n}),l;return o.saved}catch(e){return n(e=>{let n=new Set(e);return l?n.add(t):n.delete(t),n}),l}},[u,e]),f=(0,l.useCallback)(n=>e.has(n),[e]);return(0,l.useEffect)(()=>{d()},[d]),{savedIds:e,savedCards:t,loading:a,toggleSaved:c,isSaved:f,refetch:d}}},1342:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});let l="hama_session_id";function o(){try{let o=window.localStorage.getItem(l);if(!o){var e,n,t;o=null!==(t=null===(e=(n=crypto).randomUUID)||void 0===e?void 0:e.call(n))&&void 0!==t?t:"sess_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,10)),window.localStorage.setItem(l,o)}return o}catch(e){return""}}},5099:function(e,n,t){"use strict";t.d(n,{n:function(){return o}});var l=t(1342);function o(){try{let e=window.localStorage.getItem("hamaLoggedIn");if("1"===e){let e=window.localStorage.getItem("hamaUser");if(e){let n=JSON.parse(e),t=null==n?void 0:n.user_id;if(t)return"user_".concat(t)}}return"session_".concat((0,l.Z)())}catch(e){return"session_".concat((0,l.Z)())}}},7467:function(e,n,t){"use strict";t.d(n,{A:function(){return a},UIOverlayProvider:function(){return r}});var l=t(7573),o=t(7653);let i=(0,o.createContext)(null);function r(e){let{children:n}=e,[t,r]=(0,o.useState)(!1),a=(0,o.useMemo)(()=>({overlayOpen:t,setOverlayOpen:r}),[t]);return(0,l.jsx)(i.Provider,{value:a,children:n})}function a(){let e=(0,o.useContext)(i);if(!e)throw Error("useUIOverlay must be used within UIOverlayProvider");return e}},5708:function(e,n,t){"use strict";function l(e){let n=String(null!=e?e:"").toLowerCase().trim();return"beauty"===n?"salon":"fd6"===n?"restaurant":"ce7"===n?"cafe":"bk9"===n?"salon":"at4"===n?"activity":n.includes("미용")||n.includes("헤어")||n.includes("이발")?"salon":n.includes("카페")||n.includes("커피")?"cafe":n.includes("식당")||n.includes("음식")||n.includes("레스토랑")||n.includes("맛집")?"restaurant":n.includes("액티비")||n.includes("활동")||n.includes("체험")||n.includes("공원")?"activity":"restaurant"===n||"cafe"===n||"salon"===n||"activity"===n?n:"restaurant"}function o(e){var n,t,o,i,r,a,s,u,d,c,f,m,g,v,p,h,y,b,x,S,w,j,k,_,I,N,C,R,A,T,F,K,O,E,P,z,M,U;let B=String(null!==(o=null!==(t=null!==(n=null==e?void 0:e.id)&&void 0!==n?n:null==e?void 0:e.store_id)&&void 0!==t?t:null==e?void 0:e.storeId)&&void 0!==o?o:"").trim(),L=String(null!==(a=null!==(r=null!==(i=null==e?void 0:e.name)&&void 0!==i?i:null==e?void 0:e.store_name)&&void 0!==r?r:null==e?void 0:e.storeName)&&void 0!==a?a:"").trim(),q=l(null!==(f=null!==(c=null!==(d=null!==(u=null!==(s=null==e?void 0:e.category)&&void 0!==s?s:null==e?void 0:e.categoryNorm)&&void 0!==u?u:null==e?void 0:e.category_norm)&&void 0!==d?d:null==e?void 0:e.tab)&&void 0!==c?c:null==e?void 0:e.type)&&void 0!==f?f:null==e?void 0:e.kind),W=String(null!==(g=null!==(m=null==e?void 0:e.categoryLabel)&&void 0!==m?m:null==e?void 0:e.category_label)&&void 0!==g?g:function(e){let n=l(e);return"restaurant"===n?"식당":"cafe"===n?"카페":"salon"===n?"미용실":"액티비티"}(q)),D=Number(null!==(p=null!==(v=null==e?void 0:e.distanceKm)&&void 0!==v?v:null==e?void 0:e.distance_km)&&void 0!==p?p:"number"==typeof(null==e?void 0:e.distance)?e.distance/1e3:void 0),Y=Number.isFinite(D)?D:0,X=String(null!==(w=null!==(S=null!==(x=null!==(b=null!==(y=null!==(h=null==e?void 0:e.cover_image_url)&&void 0!==h?h:null==e?void 0:e.imageUrl)&&void 0!==y?y:null==e?void 0:e.image_url)&&void 0!==b?b:null==e?void 0:e.image)&&void 0!==x?x:null==e?void 0:e.thumbnail)&&void 0!==S?S:null==e?void 0:e.thumb)&&void 0!==w?w:""),V="number"==typeof(null==e?void 0:e.lat)?e.lat:"number"==typeof(null==e?void 0:e.latitude)?e.latitude:null!==(k=null!==(j=null==e?void 0:e.lat)&&void 0!==j?j:null==e?void 0:e.latitude)&&void 0!==k?k:null,H="number"==typeof(null==e?void 0:e.lng)?e.lng:"number"==typeof(null==e?void 0:e.longitude)?e.longitude:null!==(I=null!==(_=null==e?void 0:e.lng)&&void 0!==_?_:null==e?void 0:e.longitude)&&void 0!==I?I:null;return{id:B,name:L,category:q,categoryLabel:W,distanceKm:Y,moodText:String(null!==(R=null!==(C=null!==(N=null==e?void 0:e.moodText)&&void 0!==N?N:null==e?void 0:e.mood_text)&&void 0!==C?C:null==e?void 0:e.mood)&&void 0!==R?R:""),imageUrl:X,quickQuery:String(null!==(T=null!==(A=null==e?void 0:e.quickQuery)&&void 0!==A?A:null==e?void 0:e.quick_query)&&void 0!==T?T:L),lat:V,lng:H,mood:null!==(F=null==e?void 0:e.mood)&&void 0!==F?F:null,withKids:null!==(O=null!==(K=null==e?void 0:e.withKids)&&void 0!==K?K:null==e?void 0:e.with_kids)&&void 0!==O?O:null,forWork:null!==(P=null!==(E=null==e?void 0:e.forWork)&&void 0!==E?E:null==e?void 0:e.for_work)&&void 0!==P?P:null,priceLevel:null!==(M=null!==(z=null==e?void 0:e.priceLevel)&&void 0!==z?z:null==e?void 0:e.price_level)&&void 0!==M?M:null,tags:null!==(U=null==e?void 0:e.tags)&&void 0!==U?U:null}}t.d(n,{O:function(){return o}})},191:function(e,n,t){"use strict";t.d(n,{O:function(){return a}});var l=t(3088),o=t(4859);let i=o.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",r=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder",a=(0,l.eI)(i,r)},8760:function(e,n,t){"use strict";t.d(n,{default:function(){return S}});var l=t(7573),o=t(7653),i=t(1695),r=t(294);function a(e){return"cafe"===e?"카페":"restaurant"===e?"식당":"salon"===e?"미용실":"액티비티"}function s(e){return"restaurant"===e?"/images/category/restaurant.jpg":"cafe"===e?"/images/category/cafe.jpg":"salon"===e?"/images/category/salon.jpg":"/images/category/activity.jpg"}function u(e){let{query:n,hasMyLocation:t,usedChineseFallback:o=!1,pageIndex:i,pages:u,selected:d,others:c,swipeDirection:f,onBack:m,onOpenExpanded:g,onOpenKakaoPlace:v,onGoToPage:p,onTouchStart:h,onTouchEnd:y}=e,b=!!d;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{width:"100%",maxWidth:430,marginTop:0,maxHeight:60,overflow:"hidden",display:"flex",alignItems:"center"},children:[(0,l.jsx)("button",{onClick:m,style:{border:"none",background:"#ffffff",borderRadius:12,padding:"8px 10px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.08)",cursor:"pointer"},children:"⬅️"}),(0,l.jsx)("div",{style:{flex:1,marginLeft:8,padding:"8px 12px",borderRadius:9999,background:"#ffffff",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.08)",fontSize:13,color:"#4b5563",fontFamily:"Noto Sans KR, system-ui, sans-serif",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n?"“".concat(n,"” 검색 결과").concat(b?" \xb7 ".concat(a(d.categoryNorm)):"").concat(o?" (중국집 태그된 곳이 없어 주변 식당)":"").concat(t?" \xb7 내 위치 기준":""):"하마 추천 장소"})]}),(0,l.jsxs)("div",{onTouchStart:h,onTouchEnd:y,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,transform:"left"===f?"translateX(-16px)":"right"===f?"translateX(16px)":"translateX(0)",transition:"transform 0.22s ease-out"},children:[b?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{onClick:()=>g(d.id),style:{width:316,height:269,borderRadius:24,overflow:"hidden",position:"relative",boxShadow:"0 6px 18px rgba(0, 0, 0, 0.2)",cursor:"pointer",background:"#dbeafe"},children:[(0,l.jsx)(r.default,{src:d.image_url||s(d.categoryNorm),alt:d.name,fill:!0,sizes:"316px",style:{objectFit:"cover"}}),(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),v(d)},style:{position:"absolute",top:10,right:10,border:"none",borderRadius:9999,padding:"6px 10px",background:"rgba(255,255,255,0.95)",cursor:"pointer",fontSize:12,fontFamily:"Noto Sans KR, system-ui, sans-serif",boxShadow:"0 6px 18px rgba(0,0,0,0.18)"},children:[a(d.categoryNorm),"정보보기"]}),(0,l.jsxs)("div",{style:{position:"absolute",left:12,bottom:12,padding:"6px 10px",borderRadius:9999,background:"rgba(15,23,42,0.75)",color:"#f9fafb",fontSize:12,fontFamily:"Noto Sans KR, system-ui, sans-serif"},children:[d.name," \xb7 ",a(d.categoryNorm),null!=d.distanceKm&&d.distanceKm<500?" \xb7 ".concat(d.distanceKm.toFixed(1),"km"):""]})]}),(0,l.jsx)("div",{style:{display:"flex",gap:16,marginTop:8},children:c.slice(0,2).map(e=>(0,l.jsxs)("div",{onClick:()=>g(e.id),style:{width:156,height:165,borderRadius:24,overflow:"hidden",position:"relative",boxShadow:"0 6px 18px rgba(0, 0, 0, 0.2)",cursor:"pointer",background:"#dbeafe"},children:[(0,l.jsx)(r.default,{src:e.image_url||s(e.categoryNorm),alt:e.name,fill:!0,sizes:"156px",style:{objectFit:"cover"}}),(0,l.jsxs)("button",{onClick:n=>{n.stopPropagation(),v(e)},style:{position:"absolute",top:8,right:8,border:"none",borderRadius:9999,padding:"5px 8px",background:"rgba(255,255,255,0.95)",cursor:"pointer",fontSize:11,fontFamily:"Noto Sans KR, system-ui, sans-serif",boxShadow:"0 6px 18px rgba(0,0,0,0.18)"},children:[a(e.categoryNorm),"정보보기"]}),(0,l.jsxs)("div",{style:{position:"absolute",left:10,bottom:10,padding:"4px 8px",borderRadius:9999,background:"rgba(15,23,42,0.75)",color:"#f9fafb",fontFamily:"Noto Sans KR, system-ui, sans-serif",fontSize:11},children:[e.name,null!=e.distanceKm&&e.distanceKm<500?" \xb7 ".concat(e.distanceKm.toFixed(1),"km"):""]})]},e.id))})]}):(0,l.jsx)("div",{style:{width:316,height:269,borderRadius:24,overflow:"hidden",position:"relative",boxShadow:"0 6px 18px rgba(0, 0, 0, 0.18)",background:"#ffffff",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Noto Sans KR, system-ui, sans-serif",color:"#6b7280",fontSize:14},children:"하마가 학습 중이에요"}),(0,l.jsx)("div",{style:{marginTop:16,display:"flex",gap:8},children:[0,1,2].map(e=>{var n,t;let o=(null!==(t=null==u?void 0:null===(n=u[e])||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0;return(0,l.jsx)("button",{onClick:()=>p(e),disabled:!o,style:{width:10,height:10,borderRadius:"50%",border:"none",cursor:o?"pointer":"default",background:o?e===i?"#2563eb":"rgba(148,163,184,0.7)":"rgba(209,213,219,0.8)",transform:e===i&&o?"scale(1.2)":"scale(1)",transition:"background 0.2s ease, transform 0.2s ease"},"aria-label":"page-".concat(e+1)},e)})})]})]})}function d(e){return"cafe"===e?"카페":"restaurant"===e?"식당":"salon"===e?"미용실":"액티비티"}function c(e){var n;let{visible:t,expanded:o,reserveStep:i,reserveDate:a,reserveTime:s,selected:u,onClose:c,onOpenKakaoPlace:f,onGoToMap:m,onOverlayScroll:g,setReserveDate:v,setReserveTime:p,isSaved:h,onToggleSaved:y}=e;if(!t||!u)return null;let b=e=>{try{window.open(e,"_blank","noopener,noreferrer")}catch(e){}},x=e=>{var n,t,l;let o=encodeURIComponent(e);b((null===(t=(l=window).matchMedia)||void 0===t?void 0:null===(n=t.call(l,"(max-width: 768px)"))||void 0===n?void 0:n.matches)?"https://m.search.naver.com/search.naver?query=".concat(o):"https://search.naver.com/search.naver?query=".concat(o))};return(0,l.jsx)("div",{onScroll:g,style:{position:"fixed",inset:0,zIndex:3e3,background:"rgba(15,23,42,0.75)",backdropFilter:"blur(6px)",overflowY:"auto",opacity:o?1:0,transition:"opacity 0.28s ease"},children:(0,l.jsxs)("div",{style:{minHeight:"100vh",padding:"24px 12px 32px",display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[(0,l.jsxs)("div",{style:{width:"100%",maxWidth:430,height:"calc(100vh - 150px)",borderRadius:26,overflow:"hidden",position:"relative",boxShadow:"0 14px 40px rgba(0, 0, 0, 0.55)",background:"#000",opacity:o?1:0,transform:o?"translateY(0) scale(1)":"translateY(40px) scale(0.95)",transition:"opacity 0.3s ease, transform 0.3s ease"},children:[(0,l.jsx)(r.default,{src:u.image_url||("restaurant"===(n=u.categoryNorm)?"/images/category/restaurant.jpg":"cafe"===n?"/images/category/cafe.jpg":"salon"===n?"/images/category/salon.jpg":"/images/category/activity.jpg"),alt:u.name,fill:!0,sizes:"430px",style:{objectFit:"cover"}}),(0,l.jsx)("button",{onClick:c,style:{position:"absolute",top:10,left:10,width:32,height:32,borderRadius:"9999px",border:"none",background:"rgba(15,23,42,0.8)",color:"#f9fafb",cursor:"pointer",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.4)"},children:"←"}),y&&u&&(0,l.jsx)("button",{onClick:()=>y(u.id),style:{position:"absolute",top:10,right:10,width:32,height:32,borderRadius:"9999px",border:"none",background:"rgba(15,23,42,0.8)",color:(null==h?void 0:h(u.id))?"#f43f5e":"#f9fafb",cursor:"pointer",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.4)",fontSize:16},children:(null==h?void 0:h(u.id))?"♥":"♡"}),(0,l.jsxs)("button",{onClick:()=>f(u),style:{position:"absolute",top:10,right:10,border:"none",borderRadius:9999,padding:"7px 12px",background:"rgba(255,255,255,0.95)",cursor:"pointer",fontSize:12,fontFamily:"Noto Sans KR, system-ui, sans-serif",boxShadow:"0 10px 28px rgba(0,0,0,0.25)"},children:[d(u.categoryNorm),"정보보기"]}),(0,l.jsxs)("div",{style:{position:"absolute",left:14,bottom:18,padding:"6px 12px",borderRadius:9999,background:"rgba(15,23,42,0.8)",color:"#f9fafb",fontSize:13,fontFamily:"Noto Sans KR, system-ui, sans-serif"},children:[u.name," \xb7 ",d(u.categoryNorm),null!=u.distanceKm?" \xb7 ".concat(u.distanceKm.toFixed(1),"km"):""]})]}),(0,l.jsxs)("div",{style:{width:"100%",maxWidth:430,display:"flex",justifyContent:"space-between",gap:10,marginTop:14,opacity:o?1:0,transform:o?"translateY(0)":"translateY(24px)",transition:"opacity 0.3s ease 0.03s, transform 0.3s ease 0.03s"},children:[(0,l.jsx)("button",{type:"button",onClick:()=>m(u),style:{flex:1,border:"none",borderRadius:9999,padding:"11px 0",background:"#f3f4f6",fontSize:14,fontFamily:"Noto Sans KR, system-ui, sans-serif",cursor:"pointer",color:"#111827",fontWeight:800},children:"길안내"}),(0,l.jsx)("button",{type:"button",onClick:()=>x(u.name),style:{flex:1,border:"none",borderRadius:9999,padding:"11px 0",background:"#f3f4f6",fontSize:14,fontFamily:"Noto Sans KR, system-ui, sans-serif",cursor:"pointer",color:"#111827",fontWeight:800},children:"네이버로 보기"})]}),i>0&&(0,l.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:126,display:"flex",justifyContent:"center",pointerEvents:"auto"},children:(0,l.jsxs)("div",{style:{width:"100%",maxWidth:430,borderRadius:24,background:"#f9fafb",boxShadow:"0 10px 28px rgba(15,23,42,0.45)",padding:"14px 16px 16px",fontFamily:"Noto Sans KR, system-ui, sans-serif",fontSize:13,color:"#111827"},children:[1===i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{marginBottom:8,fontWeight:600,fontSize:14},children:[u.name," 예약하기"]}),(0,l.jsx)("div",{style:{marginBottom:12,color:"#4b5563",fontSize:12},children:"날짜와 시간을 선택해 주세요. (베타 테스트 화면)"}),(0,l.jsxs)("div",{style:{marginBottom:10},children:[(0,l.jsx)("div",{style:{fontSize:12,marginBottom:6,color:"#6b7280"},children:"날짜 선택"}),(0,l.jsx)("div",{style:{display:"flex",gap:8},children:[{label:"오늘",value:"오늘"},{label:"내일",value:"내일"},{label:"모레",value:"모레"}].map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>v(e.value),style:{flex:1,borderRadius:9999,border:"none",padding:"6px 0",fontSize:12,cursor:"pointer",background:a===e.value?"#2563eb":"#e5e7eb",color:a===e.value?"#ffffff":"#111827"},children:e.label},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:12,marginBottom:6,color:"#6b7280"},children:"시간 선택"}),(0,l.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:["11:00","13:00","15:00","17:00","19:00"].map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>p(e),style:{flexBasis:"30%",borderRadius:9999,border:"none",padding:"6px 0",fontSize:12,cursor:"pointer",background:s===e?"#2563eb":"#e5e7eb",color:s===e?"#ffffff":"#111827",textAlign:"center"},children:e},e))})]})]}),2===i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{marginBottom:8,fontWeight:600,fontSize:14},children:"예약이 완료된 것처럼 보여주는 화면입니다"}),(0,l.jsxs)("div",{style:{marginBottom:10,color:"#4b5563",fontSize:12},children:["베타 테스트용으로 ",(0,l.jsxs)("b",{children:[a," ",s]}),"에 예약한 것처럼 표시돼요."]}),(0,l.jsxs)("div",{style:{padding:"8px 10px",borderRadius:12,background:"#e5f2ff",fontSize:12,color:"#1f2937"},children:["• 매장: ",u.name,(0,l.jsx)("br",{}),"• 날짜: ",a,(0,l.jsx)("br",{}),"• 시간: ",s]})]})]})})]})})}var f=t(191);function m(e){let n="number"==typeof e?e:Number(e);return Number.isFinite(n)?n:null}function g(e){return Array.isArray(e)?e.map(e=>String(null!=e?e:"")).filter(Boolean):"string"==typeof e&&e.trim()?[e.trim()]:null}function v(e){let n=String(null!=e?e:"").trim(),t=n.toLowerCase();return"cafe"===t||"restaurant"===t||"salon"===t||"activity"===t?t:"beauty"===t?"salon":"CE7"===n?"cafe":"FD6"===n?"restaurant":"BK9"===n?"salon":"카페"===n?"cafe":"식당"===n?"restaurant":"미용실"===n?"salon":"액티비티"===n||"활동"===n||"공원"===n||"박물관"===n?"activity":t.includes("cafe")||t.includes("카페")?"cafe":t.includes("restaurant")||t.includes("식당")||t.includes("fd6")||t.includes("중식")||t.includes("한식")||t.includes("양식")||t.includes("일식")?"restaurant":t.includes("salon")||t.includes("미용")||t.includes("beauty")||t.includes("bk9")?"salon":t.includes("activity")||t.includes("액티비티")||t.includes("활동")||t.includes("공원")||t.includes("박물관")?"activity":null}function p(e){return String(null!=e?e:"").toLowerCase().replace(/\s+/g,"").trim()}function h(e){let n="number"==typeof e?e:Number(e);return Number.isFinite(n)?n:null}var y=t(3123),b=t(5142),x=t(7467);function S(){var e;let n=(0,i.useRouter)(),t=(0,i.useSearchParams)(),r=t.get("query")||"",a=t.get("category"),s=Number(t.get("lat")),d=Number(t.get("lng")),S=Number.isFinite(s)&&Number.isFinite(d),w=(0,o.useMemo)(()=>{let e=String(null!=a?a:"").trim(),n=e.toLowerCase();if(e&&("all"===n||"total"===n||"종합"===e))return null;if(a){let n=function(e){if(!e)return null;let n=String(e).trim(),t=n.toLowerCase();return"cafe"===t||"restaurant"===t||"salon"===t||"activity"===t?t:"CE7"===n?"cafe":"FD6"===n?"restaurant":"BK9"===n||"beauty"===t?"salon":null}(e);if(n)return n}return r.trim()?function(e){let n=String(null!=e?e:"").toLowerCase();return n.includes("미용")||n.includes("헤어")||n.includes("뷰티")||n.includes("살롱")||n.includes("salon")||n.includes("beauty")?"salon":n.includes("식당")||n.includes("밥")||n.includes("한식")||n.includes("레스토랑")||n.includes("맛집")||n.includes("중국집")||n.includes("중국")||n.includes("중식")||n.includes("일식")||n.includes("양식")||n.includes("한정식")||n.includes("혼밥")||n.includes("점심식사")||n.includes("회식")||n.includes("점심")?"restaurant":n.includes("박물관")||n.includes("공원")||n.includes("체험")||n.includes("활동")||n.includes("놀")||n.includes("키즈")?"activity":"cafe"}(r):null},[a,r]),{stores:j,loading:k}=function(){let[e,n]=(0,o.useState)([]),[t,l]=(0,o.useState)(!0),[i,r]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let e=!0;return(async()=>{l(!0),r(null);let{data:t,error:o}=await f.O.from("stores").select("id,name,category,area,address,lat,lng,phone,kakao_place_url,source,mood,with_kids,for_work,price_level,tags,reservation_required").limit(5e3);if(!e)return;if(console.log("[useSearchStores] error:",o),console.log("[useSearchStores] raw data length:",(null!=t?t:[]).length),(null==t?void 0:t[0])&&console.log("[useSearchStores] sample row:",t[0]),o){var i;console.error("Supabase stores fetch error:",o),n([]),r(null!==(i=o.message)&&void 0!==i?i:"Supabase error"),l(!1);return}let a=(null!=t?t:[]).map(e=>{var n,t,l,o,i,r,a,s,u,d,c;let f=v(e.category);if(!f)return null;let p=String(null!==(n=e.name)&&void 0!==n?n:"").trim();return p?{id:String(e.id),name:p,category:String(null!==(t=e.category)&&void 0!==t?t:""),categoryNorm:f,area:null!==(l=e.area)&&void 0!==l?l:null,address:null!==(o=e.address)&&void 0!==o?o:null,lat:m(e.lat),lng:m(e.lng),phone:null!==(i=e.phone)&&void 0!==i?i:null,kakao_place_url:null!==(r=e.kakao_place_url)&&void 0!==r?r:null,source:null!==(a=e.source)&&void 0!==a?a:null,mood:g(e.mood),tags:g(e.tags),price_level:null!==(s=e.price_level)&&void 0!==s?s:null,with_kids:null!==(u=e.with_kids)&&void 0!==u?u:null,for_work:null!==(d=e.for_work)&&void 0!==d?d:null,reservation_required:null!==(c=e.reservation_required)&&void 0!==c?c:null,image_url:null}:null}).filter(Boolean);console.log("[useSearchStores] cleaned length:",a.length),n(a),l(!1)})(),()=>{e=!1}},[]),{stores:e,loading:t,errorMsg:i}}(),{categoryStores:_,pages:I,usedChineseFallback:N}=function(e){let{stores:n,activeCategory:t,query:l,hasMyLocation:i,myLat:r,myLng:a,exploreMode:s=!0,radiusKm:u=3}=e;return(0,o.useMemo)(()=>{let e=function(e,n){let t=String(null!=e?e:"").toLowerCase().trim();if(!t)return[];let l=new Set(["카페","cafe","식당","restaurant","미용","미용실","beauty","salon","활동","액티비티","activity"].map(e=>p(e))),o=p(t);if(l.has(o))return[];let i=t.split(/[\s/|,.;:!?()\[\]{}"'`~@#$%^&*+=<>\\_-]+/g).map(e=>e.trim()).filter(Boolean),r=new Set(["근처","가까운","가까이","찾아줘","찾아","추천","알려줘","뭐","먹지","먹을까","오늘","내일","요즘","해줘","해","좀","아","그","이","저"]),a=new Set;"cafe"===n&&a.add("카페"),"restaurant"===n&&a.add("식당"),"salon"===n&&a.add("미용실"),"activity"===n&&a.add("액티비티");let s=i.filter(e=>!r.has(e)).filter(e=>!a.has(e)).map(e=>p(e)).filter(e=>e.length>=2),u={china:e=>e.includes("중국")||"중식"===e||e.includes("짜장")||e.includes("짬뽕"),korean:e=>e.includes("한정식")||"한식"===e||e.includes("정식"),solo:e=>e.includes("혼밥")||e.includes("혼자")||"1인"===e,lunch:e=>e.includes("점심")||e.includes("런치")||e.includes("브런치"),company:e=>e.includes("회식")||e.includes("단체")||e.includes("모임")};for(let[e,n]of Object.entries({china:["중국집","중국","중식","짜장","짬뽕","짜장면","탕수","마라","훠궈","딤섬","양꼬치"],korean:["한정식","한식","코스","정식","가족식사","단체가능","코다리","명태","보양식"],solo:["혼밥","혼자","1인","1인석","단독","혼술"],lunch:["점심","점심맛집","점심식사","런치","브런치","가성비","메뉴"],company:["회식","단체","모임","룸","10인","20인","단체가능","회의"]})){let t=u[e];if(s.some(t)){s=Array.from(new Set([...s,...n]));break}}return Array.from(new Set(s))}(l,t),o=(null!=n?n:[]).map(e=>{var n,t;let l=v(e.category);if(!l)return null;let o=h(e.lat),s=h(e.lng),u=null;i&&null!=o&&null!=s&&(u=function(e,n,t,l){let o=Math.sin((t-e)*Math.PI/180/2)**2+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin((l-n)*Math.PI/180/2)**2;return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371}(r,a,o,s));let d=String(null!==(n=e.name)&&void 0!==n?n:"").trim();return d?{...e,id:String(null!==(t=e.id)&&void 0!==t?t:""),name:d,category:l,lat:o,lng:s,distanceKm:u}:null}).filter(e=>null!==e),d=o,c=e.some(e=>["회식","단체","모임","혼밥","혼자","점심","한정식","한식"].includes(e)),f=t||(c?"restaurant":null);f&&(d=d.filter(e=>e.category===f));let m=d,g="restaurant"===t&&e.some(e=>["중식","짜장","짬뽕","중국집","중국","탕수","마라","훠궈","딤섬","양꼬치","짜장면"].includes(e)),y="restaurant"===t&&e.some(e=>["한정식","한식","정식","코스"].includes(e)),b=e.some(e=>["혼밥","혼자","1인"].includes(e)),x=e.some(e=>["점심","런치","브런치"].includes(e)),S=e.some(e=>["회식","단체","모임"].includes(e)),w={china:["한정식","한식","국밥","백반","김치","삼겹","갈비","찌개","비빔","냉면","분식","족발","보쌈","코다리","명태","순대국","해장국"],korean:["중국집","중국","짬뽕","짜장","마라","훠궈","양꼬치","일식","초밥","라멘","양식","파스타","스테이크"],solo:["단체전용","10인이상","20인이상"],company:["혼밥전문","1인전용"]};d=d.filter(n=>{var t,l;if(!e.length)return!0;let o=p(null!==(t=n.name)&&void 0!==t?t:""),i=p(null!==(l=n.address)&&void 0!==l?l:""),r=n.mood,a=Array.isArray(r)?p(r.join(" ")):p(null!=r?r:""),s=n.tags,u=Array.isArray(s)?p(s.join(" ")):p(null!=s?s:""),d="".concat(o," ").concat(i," ").concat(a," ").concat(u);return!(g&&w.china.some(e=>d.includes(e))||y&&w.korean.some(e=>d.includes(e))||b&&w.solo.some(e=>d.includes(e))||S&&w.company.some(e=>d.includes(e)))&&e.some(e=>o.includes(e)||i.includes(e)||a.includes(e)||u.includes(e))});let j=!1;if(g&&0===d.length&&m.length>0){let e=["중국집","중국","중식","짜장","짬뽕","짜장면","탕수","마라","훠궈","딤섬","양꼬치"];j=(d=m.filter(n=>{var t,l;let o="".concat(p(null!==(t=n.name)&&void 0!==t?t:"")," ").concat(p(null!==(l=n.address)&&void 0!==l?l:"")," ").concat(Array.isArray(n.mood)?p(n.mood.join(" ")):""," ").concat(Array.isArray(n.tags)?p(n.tags.join(" ")):"");return e.some(e=>o.includes(e))})).length>0}if(y&&0===d.length&&m.length>0){let e=["한정식","한식","정식","코스","가족식사","단체가능","코다리","명태","뷔페"];d=m.filter(n=>{var t;let l="".concat(p(null!==(t=n.name)&&void 0!==t?t:"")," ").concat(Array.isArray(n.tags)?p(n.tags.join(" ")):""," ").concat(Array.isArray(n.mood)?p(n.mood.join(" ")):"");return e.some(e=>l.includes(e))})}if(S&&0===d.length&&m.length>0){let e=["회식","단체","모임","룸","단체가능"];0===(d=m.filter(n=>{var t;let l="".concat(p(null!==(t=n.name)&&void 0!==t?t:"")," ").concat(Array.isArray(n.tags)?p(n.tags.join(" ")):""," ").concat(Array.isArray(n.mood)?p(n.mood.join(" ")):"");return e.some(e=>l.includes(e))})).length&&(d=m)}if(b&&0===d.length&&m.length>0){let e=["혼밥","혼자","1인","1인석"];0===(d=m.filter(n=>{var t;let l="".concat(p(null!==(t=n.name)&&void 0!==t?t:"")," ").concat(Array.isArray(n.tags)?p(n.tags.join(" ")):""," ").concat(Array.isArray(n.mood)?p(n.mood.join(" ")):"");return e.some(e=>l.includes(e))})).length&&(d=m)}if(x&&0===d.length&&m.length>0){let e=["점심","점심맛집","점심식사","런치","브런치","가성비"];0===(d=m.filter(n=>{var t;let l="".concat(p(null!==(t=n.name)&&void 0!==t?t:"")," ").concat(Array.isArray(n.tags)?p(n.tags.join(" ")):"");return e.some(e=>l.includes(e))})).length&&(d=m)}let k={china:["중국집","중국","중식","짜장","짬뽕","짜장면","탕수","마라","훠궈","딤섬","양꼬치"],korean:["한정식","한식","정식","코스","가족식사"],solo:["혼밥","혼자","1인","1인석"],lunch:["점심","점심맛집","점심식사","런치","브런치","가성비"],company:["회식","단체","모임","룸","단체가능"]},_=g?"china":y?"korean":b?"solo":x?"lunch":S?"company":null;if(_&&k[_]){let e=k[_],n=n=>{var t;let l="".concat(p(null!==(t=n.name)&&void 0!==t?t:"")," ").concat(Array.isArray(n.tags)?p(n.tags.join(" ")):""," ").concat(Array.isArray(n.mood)?p(n.mood.join(" ")):"");return e.filter(e=>l.includes(e)).length};d=d.sort((e,t)=>{var l,o;let i=n(e),r=n(t);return r!==i?r-i:(null!==(l=e.distanceKm)&&void 0!==l?l:Number.POSITIVE_INFINITY)-(null!==(o=t.distanceKm)&&void 0!==o?o:Number.POSITIVE_INFINITY)})}else i&&(d=d.sort((e,n)=>{var t,l;return(null!==(t=e.distanceKm)&&void 0!==t?t:Number.POSITIVE_INFINITY)-(null!==(l=n.distanceKm)&&void 0!==l?l:Number.POSITIVE_INFINITY)}));let I=!1;if(s&&i){let e=d.filter(e=>{var n;return(null!==(n=e.distanceKm)&&void 0!==n?n:Number.POSITIVE_INFINITY)<=u});e.length>0?d=e:(I=!0,d=d.slice(0,200))}let N=d;if(0===N.length&&o.length>0&&!(g||y||b||S||x)){let n=o;t&&(n=n.filter(e=>e.category===t));let l=e.length>0?n.filter(n=>{var t;let l=p(null!==(t=n.name)&&void 0!==t?t:""),o=Array.isArray(n.tags)?p(n.tags.join(" ")):"";return e.some(e=>l.includes(e)||o.includes(e))}):n;N=l.length>0?l.slice(0,200):n.slice(0,200)}let C=[...N].sort(()=>Math.random()-.5),R=[C.slice(0,3),C.slice(3,6),C.slice(6,9)];return{categoryStores:C,pages:R,usedFallbackFar:I,usedChineseFallback:j}},[n,t,l,i,r,a,s,u])}({stores:j,activeCategory:w,query:r,hasMyLocation:S,myLat:s,myLng:d,radiusKm:15}),C=(0,o.useMemo)(()=>[Array.isArray(null==I?void 0:I[0])?I[0]:[],Array.isArray(null==I?void 0:I[1])?I[1]:[],Array.isArray(null==I?void 0:I[2])?I[2]:[]],[I]),[R,A]=(0,o.useState)(0),T=null!==(e=C[R])&&void 0!==e?e:[],[F,K]=(0,o.useState)(null),[O,E]=(0,o.useState)(!1),[P,z]=(0,o.useState)(!1),[M,U]=(0,o.useState)(!1),{recordView:B}=(0,y.X)(),{toggleSaved:L,isSaved:q}=(0,b.F)(),{setOverlayOpen:W}=(0,x.A)();(0,o.useEffect)(()=>{W(O)},[O,W]);let[D,Y]=(0,o.useState)(0),[X,V]=(0,o.useState)(null),[H,J]=(0,o.useState)(null),Z=()=>{Y(0),V(null),J(null)},G=(0,o.useRef)(null),[Q,$]=(0,o.useState)(null),ee=(0,o.useMemo)(()=>{var e;if(F){let e=T.find(e=>e.id===F);if(e)return e}return null!==(e=T[0])&&void 0!==e?e:null},[T,F]),en=(0,o.useMemo)(()=>ee?T.filter(e=>e.id!==ee.id):T,[T,ee]),et=(0,o.useMemo)(()=>{let e=null!=w?w:"all",n=S?"".concat(s.toFixed(5),",").concat(d.toFixed(5)):"noloc";return"".concat(r,"__").concat(e,"__").concat(n)},[r,w,S,s,d]);(0,o.useEffect)(()=>{var e,n;A(0),E(!1),z(!1),U(!1),Z();let t=null===(e=C[0])||void 0===e?void 0:e[0];K(null!==(n=null==t?void 0:t.id)&&void 0!==n?n:null)},[et]);let el=e=>{if(e<0||e>=C.length)return;let n=C[e];n&&0!==n.length&&(A(e),K(n[0].id),E(!1),z(!1),U(!1),Z())},eo=e=>{let n="https://map.kakao.com/?q=".concat(encodeURIComponent(e.name));window.open(n,"_blank","noopener,noreferrer")},ei=()=>{z(!1),U(!1),Z(),setTimeout(()=>E(!1),280)};return((0,o.useEffect)(()=>{let e=window.sessionStorage.getItem("hama_search_last_id");if(!e)return;let n=C.findIndex(n=>n.some(n=>n.id===e));if(-1===n){window.sessionStorage.removeItem("hama_search_last_id");return}A(n),K(e),E(!0),z(!1),U(!1),Z(),setTimeout(()=>z(!0),10),window.sessionStorage.removeItem("hama_search_last_id")},[C]),k)?(0,l.jsx)("main",{style:{minHeight:"100vh",background:"#eef5fb",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Noto Sans KR, system-ui, sans-serif"},children:"불러오는 중..."}):(0,l.jsxs)("main",{style:{minHeight:"100vh",background:"#eef5fb",paddingTop:20,display:"flex",flexDirection:"column",alignItems:"center",gap:18},children:[!O&&(0,l.jsx)(u,{query:r,hasMyLocation:S,usedChineseFallback:N,pageIndex:R,pages:C,selected:ee,others:en,swipeDirection:Q,onBack:()=>n.push("/"),onOpenExpanded:e=>{K(e),B(e),U(!1),Z(),z(!1),E(!0),setTimeout(()=>z(!0),10)},onOpenKakaoPlace:eo,onGoToPage:el,onTouchStart:e=>{G.current=e.touches[0].clientX},onTouchEnd:e=>{var n,t,l,o;let i=G.current;if(null==i)return;let r=e.changedTouches[0].clientX-i;r>40?R>0&&(null!==(t=null===(n=C[R-1])||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0&&($("right"),el(R-1),setTimeout(()=>$(null),220)):r<-40&&R<C.length-1&&(null!==(o=null===(l=C[R+1])||void 0===l?void 0:l.length)&&void 0!==o?o:0)>0&&($("left"),el(R+1),setTimeout(()=>$(null),220)),G.current=null}}),(0,l.jsx)(c,{visible:O,expanded:P,detailOpen:M,reserveStep:D,reserveDate:X,reserveTime:H,selected:ee,onClose:ei,onOpenKakaoPlace:eo,onGoToMap:e=>{var t,l;window.sessionStorage.setItem("hama_search_last_id",e.id);let o=null!==(t=e.lat)&&void 0!==t?t:"",i=null!==(l=e.lng)&&void 0!==l?l:"";n.push("/map?q=".concat(encodeURIComponent(e.name),"&lat=").concat(encodeURIComponent(String(o)),"&lng=").concat(encodeURIComponent(String(i))))},onReserveClick:()=>{if(U(!1),0===D){Y(1);return}if(1===D){if(!X||!H){alert("날짜와 시간을 먼저 선택해 주세요 \uD83D\uDE42");return}Y(2);return}2===D&&Z()},onRate:()=>alert("평점 기능은 추후 버전에서 제공될 예정입니다!"),onToggleDetail:()=>{Z(),U(e=>!e)},onOverlayScroll:e=>{!M&&0===D&&e.currentTarget.scrollTop>40&&ei()},setReserveDate:e=>V(e),setReserveTime:e=>J(e),isSaved:q,onToggleSaved:L})]})}},4125:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"RouterContext",{enumerable:!0,get:function(){return l}});let l=t(1887)._(t(7653)).default.createContext(null)}},function(e){e.O(0,[399,316,293,528,744],function(){return e(e.s=1482)}),_N_E=e.O()}]);